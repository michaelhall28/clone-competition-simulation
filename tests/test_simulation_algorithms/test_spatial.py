import numpy as np
import numpy.testing
import pytest

from src.clone_competition_simulation.simulation_algorithms.general_2D_class import (
    get_neighbour_map,
    get_1D_coord,
    get_2D_coord
)

neighbour_data = [
    ((2,2), False, np.array([
        [1, 2, 3, 3, 1, 2],
        [3, 0, 2, 2, 3, 0],
        [3, 0, 1, 1, 3, 0],
        [1, 2, 0, 0, 1, 2]
    ])),
    ((4,4), False, np.array([
        [3, 12, 13, 15, 1, 4],
        [13, 0, 2, 4, 5, 6],
        [13, 14, 15, 1, 3, 6],
        [15, 2, 4, 6, 7, 0],
        [7, 0, 1, 3, 5, 8],
        [1, 4, 6, 8, 9, 10],
        [1, 2, 3, 5, 7, 10],
        [3, 6, 8, 10, 11, 4],
        [11, 4, 5, 7, 9, 12],
        [5, 8, 10, 12, 13, 14],
        [5, 6, 7, 9, 11, 14],
        [7, 10, 12, 14, 15, 8],
        [15, 8, 9, 11, 13, 0],
        [9, 12, 14, 0, 1, 2],
        [9, 10, 11, 13, 15, 2],
        [11, 14, 0, 2, 3, 12]
    ])),
    ((4,6), False, np.array([
        [5, 18, 19, 23, 1, 6],
        [19, 0, 2, 6, 7, 8],
        [19, 20, 21, 1, 3, 8],
        [21, 2, 4, 8, 9, 10],
        [21, 22, 23, 3, 5, 10],
        [23, 4, 6, 10, 11, 0],
        [11, 0, 1, 5, 7, 12],
        [1, 6, 8, 12, 13, 14],
        [1, 2, 3, 7, 9, 14],
        [3, 8, 10, 14, 15, 16],
        [3, 4, 5, 9, 11, 16],
        [5, 10, 12, 16, 17, 6],
        [17, 6, 7, 11, 13, 18],
        [7, 12, 14, 18, 19, 20],
        [7, 8, 9, 13, 15, 20],
        [9, 14, 16, 20, 21, 22],
        [9, 10, 11, 15, 17, 22],
        [11, 16, 18, 22, 23, 12],
        [23, 12, 13, 17, 19, 0],
        [13, 18, 20, 0, 1, 2],
        [13, 14, 15, 19, 21, 2],
        [15, 20, 22, 2, 3, 4],
        [15, 16, 17, 21, 23, 4],
        [17, 22, 0, 4, 5, 18]
    ])),
    ((2,2), True, np.array([
        [1, 2, 3, 3, 1, 2, 0],
        [3, 0, 2, 2, 3, 0, 1],
        [3, 0, 1, 1, 3, 0, 2],
        [1, 2, 0, 0, 1, 2, 3]
    ])),
    ((4,4), True, np.array([
        [3, 12, 13, 15, 1, 4, 0],
        [13, 0, 2, 4, 5, 6, 1],
        [13, 14, 15, 1, 3, 6, 2],
        [15, 2, 4, 6, 7, 0, 3],
        [7, 0, 1, 3, 5, 8, 4],
        [1, 4, 6, 8, 9, 10, 5],
        [1, 2, 3, 5, 7, 10, 6],
        [3, 6, 8, 10, 11, 4, 7],
        [11, 4, 5, 7, 9, 12, 8],
        [5, 8, 10, 12, 13, 14, 9],
        [5, 6, 7, 9, 11, 14, 10],
        [7, 10, 12, 14, 15, 8, 11],
        [15, 8, 9, 11, 13, 0, 12],
        [9, 12, 14, 0, 1, 2, 13],
        [9, 10, 11, 13, 15, 2, 14],
        [11, 14, 0, 2, 3, 12, 15]
    ])),
    ((4,6), True, np.array([
        [5, 18, 19, 23, 1, 6, 0],
        [19, 0, 2, 6, 7, 8, 1],
        [19, 20, 21, 1, 3, 8, 2],
        [21, 2, 4, 8, 9, 10, 3],
        [21, 22, 23, 3, 5, 10, 4],
        [23, 4, 6, 10, 11, 0, 5],
        [11, 0, 1, 5, 7, 12, 6],
        [1, 6, 8, 12, 13, 14, 7],
        [1, 2, 3, 7, 9, 14, 8],
        [3, 8, 10, 14, 15, 16, 9],
        [3, 4, 5, 9, 11, 16, 10],
        [5, 10, 12, 16, 17, 6, 11],
        [17, 6, 7, 11, 13, 18, 12],
        [7, 12, 14, 18, 19, 20, 13],
        [7, 8, 9, 13, 15, 20, 14],
        [9, 14, 16, 20, 21, 22, 15],
        [9, 10, 11, 15, 17, 22, 16],
        [11, 16, 18, 22, 23, 12, 17],
        [23, 12, 13, 17, 19, 0, 18],
        [13, 18, 20, 0, 1, 2, 19],
        [13, 14, 15, 19, 21, 2, 20],
        [15, 20, 22, 2, 3, 4, 21],
        [15, 16, 17, 21, 23, 4, 22],
        [17, 22, 0, 4, 5, 18, 23]
    ])),
]


@pytest.mark.parametrize("grid_shape,cell_in_neighbourhood,expected", neighbour_data)
def test_neighbours(grid_shape, cell_in_neighbourhood, expected):
    neighbour_map = get_neighbour_map(grid_shape, cell_in_neighbourhood)
    numpy.testing.assert_array_equal(neighbour_map, expected)


@pytest.mark.parametrize("row,col,grid_shape,expected", [
    [0, 0, (10, 8), 0],
    [0, 1, (10, 8), 1],
    [7, 9, (10, 8), 79],
    [0, 9, (10, 8), 9],
    [7, 0, (10, 8), 70],
])
def test_get_1D_coord(row, col, grid_shape, expected):
    coord = get_1D_coord(row, col, grid_shape)
    assert coord == expected


@pytest.mark.parametrize("idx,grid_shape,expected", [
    [0, (10, 8), (0, 0)],
    [1, (10, 8), (0, 1)],
    [79, (10, 8), (7, 9)],
    [9, (10, 8), (0, 9)],
    [70, (10, 8), (7, 0)],
])
def test_get_2D_coord(idx, grid_shape, expected):
    row, col = get_2D_coord(idx, grid_shape)
    assert (row, col) == expected
